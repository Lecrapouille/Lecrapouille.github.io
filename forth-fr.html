<!-- This page was generated by script Sun 29 Sep 19 -->

<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">

<!-- HTML META -->
<head>
<title>Interpr&eacute;teur Forth</title>
<meta name="author" content="Quentin Quadrat" />
<meta name="copyright" content="Creative Common BY-NC-SA" />
<meta name="keywords" content="Forth language" />
<meta name="description" content="A introduction to Forth language" />
<meta name="generator" content="GNU m4" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/styles.css" rel="stylesheet" type="text/css" />
</head>

<!-- HTML BODY -->
<body><a id="top_page" name="top_page"></a>
<table id="document">

  <!-- DOCUMENT HEADER -->

  <!-- Page Title -->
  <tr>
    <td colspan="2">
      <div id="main_title">
        Interpr&eacute;teur Forth
      </div>
    </td>
    <td id="right_top_border"></td>
  </tr>

  <!-- Primary Menu -->
  <tr>
    <td colspan="2">
      <!-- Begin Menu -->
<div id="primary_header">
<ul class="rubriques2">
<li><a href="helico_intro-fr.html"><img class="icone20" src="icons/gear.png" alt=""/>Syst&egrave;mes embarqu&eacute;s</a></li>
<li><a href="dyna-fr.html"><img class="icone20" src="icons/read.png" alt=""/>Tutoriels</a></li>
<li><a href="simtadyn-fr.html"><img class="icone20" src="icons/eyes.png" alt=""/>Projets informatiques</a></li>
<li><a href="index-fr.html"><img class="icone20" src="icons/home.png" alt=""/>Accueil</a></li>
</ul>
</div>
<!-- End Menu -->
    </td>
    <td id="right_border"> <!-- empty --> </td>
  </tr>

  <!-- Secondary Menu -->
  <tr>
    <td colspan="2">
      <!-- Begin Menu -->
<div id="secondary_header">
<ul class="rubriques3">
<li><a href="bsp-fr.html">BSP</a></li>
<li><a href="syndex-fr.html">SynDEX</a></li>
<li><a href="maxplus-fr.html">Bo&icirc;te &agrave; outils Max+</a></li>
<li id="actif3">Interpr&eacute;teur Forth</li>
<li><a href="dyna-fr.html">Dynamique d'une voiture</a></li>
</ul>
</div>
<!-- End Menu -->
    </td>
    <td id="right_border"> <!-- empty --> </td>
  </tr>

  <!-- DOCUMENT BODY -->
  <tr>
    <!-- BEGIN LEFT BORDER -->
    <td id="left_border">
        <div id="menu">
           <!-- Translated Pages -->
           <p><img src="icons/fr.png" style="border:0;" alt="fr"/> <a href="forth-en.html"><img src="icons/en.png" style="border:0;" alt="en"/></a></p>

           <!-- BEGIN LEFT BORDER DIVERSION -->
           <!-- Begin Table of Contents -->
<h1>Table des mati&egrave;res:</h1>
<ul class="items">
<li><a href="#ref"><img class="icone7" src="icons/bullet.gif" alt=""/>R&eacute;f&eacute;rences &agrave; Forth.</a></li>
<li><a href="#intro"><img class="icone7" src="icons/bullet.gif" alt=""/>Histoire du Forth.</a></li>
<li><a href="#color"><img class="icone7" src="icons/bullet.gif" alt=""/>Coloration syntaxique.</a></li>
<li><a href="#theo"><img class="icone7" src="icons/bullet.gif" alt=""/>Rapide aper&ccedil;u de la th&eacute;orie des langages.</a></li>
<li><a href="#sansyn"><img class="icone7" src="icons/bullet.gif" alt=""/>Forth un langage sans syntaxe.</a></li>
<li><a href="#pile"><img class="icone7" src="icons/bullet.gif" alt=""/>Forth un langage &agrave; piles.</a></li>
<li><a href="#dico"><img class="icone7" src="icons/bullet.gif" alt=""/>Dictionnaire Forth: une machine virtuelle.</a></li>
<li><a href="#class"><img class="icone7" src="icons/bullet.gif" alt=""/>Diff&eacute;rentes classes de mots.</a></li>
<li><a href="#interpret"><img class="icone7" src="icons/bullet.gif" alt=""/>Fonctionnement de interpr&eacute;teur externe.</a></li>
<li><a href="#interpreteur"><img class="icone7" src="icons/bullet.gif" alt=""/>Fonctionnement de interpr&eacute;teur interne.</a></li>
<li><a href="#var"><img class="icone7" src="icons/bullet.gif" alt=""/>Variables et constante.</a></li>
<li><a href="#evol"><img class="icone7" src="icons/bullet.gif" alt=""/>Un langage evolutif.</a></li>
</ul><!-- End Table of Contents -->

           <!-- END LEFT BORDER DIVERSION -->

<br/><hr/><!-- Begin Badges -->
<p>Les documents (PDF, codes sources, programmes, ...) fournis sur ce site sont mis &agrave; disposition sous licences </p>
<table width="100%" align="center">
<tr><td colspan="2"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.fr"><img alt="CC" style="border:0;" height="60" width="128" src="https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png" /></a></td><td><a href="https://www.gnu.org/licenses/gpl-3.0.fr.html"><img alt="GNU GPL" style="border:0;" src="http://creativecommons.org/images/public/cc-GPL-a.png" /></a></td></tr>
<tr><td><a href="http://validator.w3.org/check?uri=referer">
<img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!"
style="border:0" height="15" width="66" /></a></td><td><a href="http://jigsaw.w3.org/css-validator/check/referer">
<img src="icons/css.gif" alt="Valid CSS!" style="border:0" height="15" width="66" /></a></td><td><!-- phpmyvisites -->
<a href="http://st.free.fr/" title="phpMyVisites | Open source web analytics"
onclick="window.open(this.href);return(false);"><script type="text/javascript">
<!--
var a_vars = Array();
var pagename='';
var phpmyvisitesSite = 21477; var phpmyvisitesURL = "http://st.free.fr/phpmyvisites.php";
//-->
</script>
<script language="javascript" src="http://st.free.fr/phpmyvisites.js" type="text/javascript"></script>
<object><noscript><p>phpMyVisites | Open source web analytics
<img src="http://st.free.fr/phpmyvisites.php" alt="Statistics" style="border:0" />
</p></noscript></object></a>
<!-- /phpmyvisites --></td></tr>
</table><hr/>
<!-- End Badges -->
<a href="https://github.com/Lecrapouille/WebSiteGenerator" target="_blank"><img src="icons/github.png" alt="github" height="40" width="40" border="0"/></a> <img src="icons/github.png" alt="github" height="16" width="16" border="0"/>
<!-- Left Heading -->
<h1><!-- Update -->
Page auto-g&eacute;n&eacute;r&eacute;e le :</h1>
<ul class="items">
 <li><a href="https://github.com/Lecrapouille/WebSiteGenerator"><img class="icone7" src="icons/bullet.gif" alt=""/>Sun 29 Sep 19.</a></li> 
</ul>

<hr/>
        </div>
    </td>
    <!-- END LEFT BORDER -->

    <!-- BEGIN ARTICLE -->
    <td id="article">
        

<!-- Section: Le langage Forth -->
<h1>Le langage Forth</h1>

<!-- Subsection: R&eacute;f&eacute;rences &agrave; Forth -->
<a id="ref" name="ref"></a><h2><img class="icone20" src="icons/read.png" alt=""/>R&eacute;f&eacute;rences &agrave; Forth</h2>
<div class="boite"> 

<p>Le but de ce document est de faire d&eacute;couvrir (ou red&eacute;couvrir) le
langage Forth, d'expliquer son fonctionnement interne et de mieux
faire comprendre certains mots dits <strong>de hauts niveaux</strong>. Ce
document montre aussi qu'il existe, non pas un unique langage Forth
standardis&eacute; mais des Forth personnalis&eacute;s et adapt&eacute;s &agrave; chaque projet.
Avant de poursuivre la lecture de ce tutoriel, voici une s&eacute;lection non
exaustive d'ouvrages et de liens que je recommande de lire. Je sugg&egrave;re
aux lecteurs qui n'ont jamais connu ce langage de s'initier avec les
deux premiers liens puis, si possible le livre de W.P. Salman,
O. Tisserand, B. Toulout qui est, selon moi, un livre de r&eacute;f&eacute;rence
expliquant compl&eacute;tement le fonctionnement interne du Forth.</p>

<!-- Begin List -->
<ul>
<li><img src="icons/fr.png" style="border:0;" alt="fr"/>
<a href="https://www.rfc1149.net/download/documents/ifi/forth.pdf" target="_blank">Un
cours</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> acad&eacute;mique sur le Forth. Ce document est int&eacute;ressant car il
parle de la derni&egrave;re variante de Forth invent&eacute; par Moore: colorForth.</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/> <a href="https://www.forth.com/starting-forth/" target="_blank">Starting Forth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>
est le cours d'introduction p&eacute;dagogique recommand&eacute; pour s'initier &agrave; ce
langage.</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/> <a href="http://lars.nocrew.org/forth2012/core.html" target="_blank">forth2012</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> le
glossaire Forth ANSI 2012.</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/> <img src="icons/fr.png" style="border:0;" alt="fr"/>
<a href="https://www.amazon.com/FORTH-W-P-SALMAN/dp/0387912568/" target="_blank">Forth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>
W.P. Salman, O. Tisserand, B. Toulout. Edition Macmillan (english
version) ou Edition Eyrolles (french version) 1983. (ISBN-13:
978-0387912561, ISBN-10: 0387912568) est un excellent livre d&eacute;crivant
de fa&ccedil;on compl&egrave;te la th&eacute;orie du fonctionnement d'un interpr&eacute;teur
Forth. Avec ce livre seul, il est possible de re-cr&eacute;er son propre
Forth. A noter que la version fran&ccedil;aise 1983 contient quelques erreurs
de typographie dans du code Forth corrig&eacute;es dans la version anglaise
(et probablement la version fran&ccedil;aise de 1984).</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/>
<a href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD" target="_blank">JonesForth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>
Un excellent tutoriel sur l'impl&eacute;mentation d'un interpr&eacute;teur Forth
&eacute;crit en assembleur i386. Cet document compl&egrave;te le livre de
W.P. Salman pour la clart&eacute; de ses explications et de son
impl&eacute;mentation tr&egrave;s claire en code assembleur (il existe des versions
de ce code pour d'autre assembleur et dont un fonctionnant pour
Arduino Due, voir lien suivant). L'interpr&eacute;teur n'est pas complet mais
les explications y sont plus claires.)</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/> <a href="https://github.com/ekoeppen/CoreForth" target="_blank">CoreForth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> un
  Forth pour Cortex M0 et M3. Fonctionne chez moi avec une carte
  <a href="https://www.arduino.cc/en/Main/arduinoBoardDue" target="_blank">Arduino Due</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>.</li>
<li><img src="icons/fr.png" style="border:0;" alt="fr"/>
<a href="https://www.amazon.fr/Concept-Forth-Langage-syst%C3%A8me-dexploitation/dp/2866990110" target="_blank">Le Concept Forth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> de Pascal Courtois (fran&ccedil;ais, ISBN-10:
2866990110, ISBN-13: 978-2866990114). Explique les mots de base,
comment fonctionne un interpr&eacute;teur Forth mais est moins complet que le
livre Forth de W.P. Salman. On peut trouver des extraits sur Google
(avec l'aimable autorisation de son auteur). Il donne des programmes
assembleur sur des interpr&eacute;teurs Forth mais ils sont difficilement
compr&eacute;hensibles et pour des vieux micro et il vaudra mieux se baser le
lien pr&eacute;c&eacute;dent.</li>
<li><img src="icons/fr.png" style="border:0;" alt="fr"/> <a href="http://jpb.forth.free.fr/" target="_blank">Entrer dans le monde du
Forth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> Tr&egrave;s belle r&eacute;alisation de cartes &eacute;lectroniques pour syst&egrave;mes
Forth. Les explications sont claires mais peu nombreuses.</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/> <a href="http://thinking-forth.sourceforge.net/" target="_blank">Thinking Forth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>
Livre pour les d&eacute;veloppeurs mod&eacute;r&eacute;s en Forth donnant des conseils sur
comment bien penser son projet en Forth. Ce livre est destin&eacute; pour les
enthousiastes non d&eacute;butants.</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/>
<a href="https://www.amazon.com/Object-Oriented-Forth-Dick-Pountain/dp/0125635702" target="_blank">Object
Oriented Forth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> Livre expliquant comment faire &eacute;voluer son Forth pour
le programmer fa&ccedil;on objet.</li>
</ul>
<!-- End list -->

<p>Voici une liste non exhaustive de Forth non payants :</p>

<!-- Begin List -->
<ul>
<li><img src="icons/en.png" style="border:0;" alt="en"/> <a href="https://www.gnu.org/software/gforth/" target="_blank">gForth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> le Forth GNU
toujours activement d&eacute;velopp&eacute; et servant de r&eacute;f&eacute;rence.</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/> <a href="https://thebeez.home.xs4all.nl/4tH/4tHmanual.pdf" target="_blank">4th</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>
un Forth consid&eacute;r&eacute; comme ne crashant jamais.</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/> <img src="icons/fr.png" style="border:0;" alt="fr"/> <a href="http://christophe.lavarenne.free.fr/ff/" target="_blank">FreeForth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> un Forth
fait par Christophe Lavarenne o&ugrave; le mode ex&eacute;cution n'existe plus et
est remplac&eacute; par la compilation d'un mot anonyme.</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/> <a href="http://www.softsynth.com/pforth" target="_blank">pForth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> un Forth connu
  &agrave; son &eacute;poque et portable en C mais n'est plus d&eacute;velopp&eacute;.</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/> <a href="https://github.com/seanpringle/reforth" target="_blank">reForth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> un
  Forth &eacute;crit en C avec des modifications int&eacute;ressantes vis &agrave; vis des
  Forth standards. Il n'est plus d&eacute;velopp&eacute;.</li>
<li><img src="icons/en.png" style="border:0;" alt="en"/> <img src="icons/fr.png" style="border:0;" alt="fr"/> <a href="simtadyn-fr.html">SimForth</a> mon interpr&eacute;teur Forth
fait maison, portable, &eacute;crit en C++ pour les besoins de mon projet
personnel de cartes g&eacute;ographiques SimTaDyn. Il est inspir&eacute; de pForth
et du livre et cr&eacute;&eacute; contenant son mon interpr&eacute;teur Forth. J'utilise le
C++ pour avoir &agrave; la fois un interpr&eacute;teur Forth classique (compilable
s&eacute;par&eacute;ment du projet principal), tout en ayant un interpr&eacute;teur
sp&eacute;cialis&eacute; pour mes cartes g&eacute;ographiques.</li>
</ul>
<!-- End list -->

<div class="right"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></div></div>
<!-- Subsection: Histoire du Forth -->
<a id="intro" name="intro"></a><h2><img class="icone20" src="icons/read.png" alt=""/>Histoire du Forth</h2>
<div class="boite"> 

<p>Forth est un langage invent&eacute; par Charles H. Moore dans les ann&eacute;es
1970 afin de palier la lourdeur des langages de l'&eacute;poque incompatibles
pour des applications temps r&eacute;el, Moore travaillant &agrave; l'&eacute;poque &agrave;
l'Observatoire National de Radio-Astronomie des Etats-Unis. Forth a
&eacute;t&eacute; con&ccedil;u pour &ecirc;tre le plus simple et minimaliste possible o&ugrave; avec
environ 150 mots du langage, un petit syst&egrave;me d'exploitation peut &ecirc;tre
cr&eacute;&eacute;. Forth fut, par la suite, devenu un langage largement utilis&eacute;
dans ce milieu (comme par la NASA) mais aussi pour des machines
personnelles telles que le Machintosh avec le MacForth (pour ne citer
que lui). Forth a &eacute;t&eacute; utilis&eacute;, &agrave; ces &eacute;poques, en industrie pour tester
et d&eacute;boguer les registres des nouveaux chips (SoC). Actuellement, le
prix du stockage m&eacute;moire ayant fortement baiss&eacute; et la puissance brute
en calcul augment&eacute;e, l'optimisation des ressources des syst&egrave;mes
embarqu&eacute;s est devenu moins critique, ce langage est devenu beaucoup
moins &agrave; la mode l&agrave; o&ugrave; le C demeure toujours en ma&icirc;tre.</p>

<p>Comme nous allons le d&eacute;tailler tout le long de ce document, faire
son propre interpr&eacute;teur Forth est tr&egrave;s simple, chacun pouvant poss&eacute;der
le sien mais pas forc&eacute;ment compatible avec celui d'un autre. Cela fut
un point noir de ce langage qui malgr&eacute; plusieurs tentatives de
standards (78, 79, 83, 2012 ...) pour normaliser les mots les plus
courants ne furent pas forc&eacute;ment b&eacute;n&eacute;fique au langage. Pour
information, Charles H. Moore est toujours actif. Il a quitt&eacute; le
consortium, jugeant que la normalisation nuisait &agrave; l'innovation de
nouveaux Forth. Il a ainsi pu continuer &agrave; simplifier les structures
Forth comme expliqu&eacute; dans
<a href="https://www.rfc1149.net/download/documents/ifi/forth.pdf" target="_blank">le
lien suivant, section Structures simplifi&eacute;es</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>. Avec
<a href="https://blogs.msdn.microsoft.com/ashleyf/2013/11/02/the-beautiful-simplicity-of-colorforth/" target="_blank">colorForth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>
Moore a ajout&eacute; un r&ocirc;le aux mots en leur ajoutant une couleur. Il a
&eacute;galement fond&eacute; GreenArrays Inc. qui produit des puces
<a href="http://bitlog.it/programming-languages/getting-started-with-the-ga144-and-arrayforth/" target="_blank">GA144</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>
contenant un r&eacute;seau communicant de sous-processeurs Forth dont le
<a href="https://www.google.com/patents/US7752422" target="_blank">brevet</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> explique
clairement le fonctionnement (et est tr&egrave;s lisible pour un brevet).</p>

<p>Nous allons, tout au long de ce document, revenir sur chaque
&eacute;l&eacute;ments de la d&eacute;finition, mais en quelques mots Forth peut-&ecirc;tre
r&eacute;sum&eacute; &agrave; :</p>

<!-- Begin List -->
<ul>
<li>un langage &agrave; piles;</li>
<li>un langage extensible avec une syntaxe auto-&eacute;volutive (r&eacute;-entrance, m&eacute;taprogrammtion);</li>
<li>semi-compil&eacute; (embarquant son propre compilateur hybrid&eacute; avec un interpr&eacute;teur);</li>
<li>peut &ecirc;tre vu comme un syst&egrave;me d'exploitation car il est &agrave; la fois un
langage, une machine virtuelle car Forth sait g&eacute;rer sa propre
m&eacute;moire de masse et dispose d'entr&eacute;es/sorties;</li>
<li>il est &agrave; la fois un langage bas-niveau (manipulant de l'assembleur et
des registres hardware) et un langage haut-niveau (abstraction des
donn&eacute;es, faible couplage, peut &ecirc;tre orient&eacute; objet, etc);</li>
<li>bien que la plupart des langages soient complets au sens de Turing,
Forth offre &agrave; l'utilisateur la possibilit&eacute; d'acc&eacute;der directement aux
diff&eacute;rents &eacute;l&eacute;ments d'une machine de Turing (ruban infini, t&ecirc;te de
lecture/&eacute;criture, registre d'&eacute;tat, table d'actions.)</li>
</ul>
<!-- End list -->

<div class="right"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></div></div>
<!-- Subsection: Coloration syntaxique -->
<a id="color" name="color"></a><h2><img class="icone20" src="icons/eyes.png" alt=""/>Coloration syntaxique</h2>
<div class="boite"> 

<p>Pour ce document, nous allons, concernant la coloration syntaxique,
   prendre une convention qui n'est pas officielle mais inspir&eacute;e de
   ColorForth, mais dans ce document la couleur est purement
   d&eacute;corative, contrairement &agrave; ColorForth qui ajoute une information
   aux mots Forth pour le compilateur:</p>

<table width="90%" align="center">
    <tr>
        <td align="center">Couleur</td>
        <td align="center">Quand</td>
        <td align="center">But</td>
    </tr>
    <tr>
        <td align="center"><strong>En gras</strong></td>
        <td align="center">ignor&eacute;</td>
        <td align="center">Les commentaires</td>
    </tr>
    <tr>
        <td align="center"><font color="grey"><strong>En gris</strong></font></td>
        <td align="center">compilation/ex&eacute;cution</td>
        <td align="center">les mots manipulant les nombres dans la pile des donn&eacute;es</td>
    </tr>
    <tr>
        <td align="center"><font color="red"><strong>En rouge</strong></font></td>
        <td align="center">compilation</td>
        <td align="center">la d&eacute;finition d'un nouveau mot</td>
    </tr>
    <tr>
        <td align="center"><font color="ff9900"><strong>En orange</strong></font></td>
        <td align="center">compilation</td>
        <td align="center">les mots imm&eacute;diats</td>
    </tr>
    <tr>
        <td align="center"><font color="2100ae"><strong>En bleu</strong></font></td>
        <td align="center">ex&eacute;cution</td>
        <td align="center">les litt&eacute;raux</td>
    </tr>
    <tr>
        <td align="center"><font color="green"><strong>En vert</strong></font></td>
        <td align="center">ex&eacute;cution</td>
        <td align="center">saute sur la d&eacute;finition d'un mot non primitif</td>
    </tr>
</table>

<!-- Begin List -->
<ul>
<li><font color="red"><strong>En rouge</strong></font> les litt&eacute;raux;</li>
<li><font color="green"><strong>En vert</strong></font> la d&eacute;finition d'un
   nouveau mot;</li>
<li><font color="ff9900"><strong>les mots imm&eacute;diats</strong></font>;</li>
<li><font color="2100ae"><strong>En bleu</strong></font> les mots de
   structure conditionnelle;</li>
<li><font color="grey"><strong>En gris</strong></font> les commentaires.</li>
</ul>
<!-- End list -->
</p>

<div class="right"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></div></div>
<!-- Subsection: Rapide aper&ccedil;u de la th&eacute;orie des langages -->
<a id="theo" name="theo"></a><h2><img class="icone20" src="icons/eyes.png" alt=""/>Rapide aper&ccedil;u de la th&eacute;orie des langages</h2>
<div class="boite"> 

<p>Le but de cette section n'est pas d'expliquer la th&eacute;orie des
langages mais plut&ocirc;t de faire resentir au lecteur la difficult&eacute; de ce
sujet et par contraste de montrer la simplicit&eacute; du langage Forth. Par
cons&eacute;quent, cette section empruntera de grossiers racourcis.</p>

<p>Pour rappel et faire tr&egrave;s simple, en th&eacute;orie des langages, un
<em>compilateur</em> est un outil qui transforme un langage
informatique en un autre langage. Par exemple du langage C au langage
machine directement &eacute;x&eacute;cutable. Pour cela un compilateur utilise
g&eacute;n&eacute;ralement deux outils:</p>

<!-- Begin List -->
<ul>
<li>Un <em>lexer</em> est un outil d'analyse lexicale qui convertit un
texte (entr&eacute;e) en une liste d'unit&eacute; lexicale (sortie) appel&eacute;e
<em>symboles</em> (tokens en anglais).</li>
<li>Cette liste est ensuite consomm&eacute;e par un second outil appel&eacute;
<em>parser</em> qui retourne un
<a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" target="_blank">arbre de
syntaxe</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> abstraite (AST en anglais) o&ugrave; les noeuds de cet arbre sont
les op&eacute;rateurs et les feuilles les op&eacute;randes et que l'on visite avec
un parcour
<a href="https://fr.wikipedia.org/wiki/Parcours_d%27arbre" target="_blank">main-gauche</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>. Le
terme <em>abstrait</em> vient du fait qu'un
<a href="https://en.wikipedia.org/wiki/Parse_tree" target="_blank">Parse tree</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> est une
r&eacute;presentation concr&egrave;te et compl&egrave;te du texte alors que l'AST ne garde
que certains de ces &eacute;l&eacute;m&eacute;nts.</li>
</ul>
<!-- End list -->

<p>Une fois l'AST construit, cette structure est plus simple pour le
compilateur de la travailler. Un compilo C aurait analyser un certain
nombre fois une analyse de l'AST pour en cr&eacute;er des AST contenant des
pseudo-instructions de plus en plus proche de l'assembleur de la
machine cible. Il aurait &eacute;galement g&eacute;n&eacute;r&eacute; un graphe colori&eacute; afin de
conna&icirc;tre le nombre minimal de registres n&eacute;cessaires pour les
variables locales (par exemple dans notre cas, un registre pour
stocker le r&eacute;sultat 14), etc.</p>

<p>Donnons un exemple de code en langage C:</p>

<div class="code"><pre><code>display(2 + 3 * 4);
</code></pre></div>

<p>Un compilateur C, lors d'une premi&egrave;re passe d'interpr&eacute;tation,
aurait d&eacute;tect&eacute; la priorit&eacute; de la multiplication sur l'addition via une
grammaire non-ambigue et aurait ajout&eacute; implicitement les parenth&egrave;ses
suivantes:</p>

<div class="code"><pre><code>display(2 + (3 * 4));
</code></pre></div>

<p>puis aurait g&eacute;n&eacute;r&eacute; un ParsTree similaire &agrave;:</p>

<div class="code"><pre><code>              expr
               |
       ------------------
       |       |        |
    display  factor    term
               |        |
          -----------   ;
           |   |    |
           (  expr  )
               |
        ---------------
         |     |     |
        term   +   factor
         |           |
         2      ------------
                 |   |    |
                 (  expr  )
                     |
                -------------
                 |    |    |
                term  *   term
                 |         |
                 3         4
</code></pre></div>

<p>Puis un AST:</p>
<div class="code"><pre><code>     display
       /
      +
     / \
    *   2
   / \
  3    4
</code></pre></div>

<p>Puis des AST avec des instructions de plus en plus proches du
langage machine et obtenir du code similaire &agrave; &ccedil;a. Ici on ne montre
pas le graphe color&eacute; pour allouer le moins de registres possibles:</p>

<div class="code"><pre><code>
push %eax       ; save value of e1 on the stack
pop %ecx        ; pop e1 from the stack into ecx
addl %ecx, %eax ; add e1 to e2, save results in eax
...
</code></pre></div>

<p>En langage LISP, gr&acirc;ce &agrave; sa syntaxe repr&eacute;sentant des arbres, on
aurait implicitement l'AST car on aurait &eacute;crit quelque chose
d'approchant &agrave; :</p>

<div class="code"><pre><code>(display (+ (* 3 4) 2))
</code></pre></div>

<div class="right"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></div></div>
<!-- Subsection: Forth un langage sans syntaxe -->
<a id="sansyn" name="sansyn"></a><h2><img class="icone20" src="icons/eyes.png" alt=""/>Forth un langage sans syntaxe</h2>
<div class="boite"> 

<p>Forth est &agrave; la fois un interpr&eacute;teur et un compilateur. Forth ne
compile pas le code en langage machine (comme pour le langage C) mais
du byte-code dans une machine virtuelle (comme pour Java).</p>

<p>La grammaire de Forth, contrairement aux langages tels que le C ou
Python, n'a pas de grammaire ambigu&euml;, ne n&eacute;cessite pas de r&eacute;tro-action
lexicale, etc. Un script Forth est une simple suite de
<em>symboles</em> s&eacute;par&eacute;s par des espaces. Il n'y a donc aucune
syntaxe. Par cons&eacute;quent un compilateur Forth est un simple lexer sans
son parser. Quand il va lire un script, il n'a besoin que d'extraire
et de reconnaitre le symbole courant (qui doit &ecirc;tre soit un symbole
qui lui est <em>"connu"</em>, soit un nombre) et parfois le symbole
suivant (quand celui-ci n'est pas encore connu, comme par exemple lors
de la d&eacute;finition d'un nouveau symbole/d&eacute;finition Forth). Dans une
<a href="#section">dico</a> de ce document, on expliquera ce que le verbe
conna&icirc;tre signifie concr&ecirc;tement. Nous verrons &eacute;galement que ce sont
les symboles eux m&ecirc;mes qui agissent directement sur le comportement du
compilateur.</p>

<p>Dans la convention Forth, une unit&eacute; lexicale est appel&eacute; <em>mot</em>
(word en anglais) et sa signification est proche de celle du langage
naturel humain. Egalement par convention, un mot Forth est form&eacute; de
n'importe quelle suite de caract&egrave;res ASCII (il n'y a r&eacute;ellement aucune
restriction contrairement &agrave; des langages tels que C) dont,
historiquement, la taille maximale est 31 caract&egrave;res ASCII (mais cette
limitation a disparue sur certains Forth tels que gForth).</p>

<p>Cette absence de syntaxe s'explique facilement: Forth utilise la
notation polonaise invers&eacute;e (Reverse Polish notation) &agrave; savoir que les
op&eacute;randes (param&egrave;tres) sont not&eacute;es avant les op&eacute;rateurs. Cette
notation &eacute;vite l'utilisation de parenth&egrave;ses palliant l'ordre de
priorit&eacute; des op&eacute;rateurs (par exemple en math&eacute;matique la priorit&eacute; de la
multiplication sur celle de l'addition) et &eacute;vitant ainsi l'utilisation
d'une grammaire complexe impliquant la cr&eacute;ation d'un AST.</p>

<p>Le code Forth suivant :</p>
<div class="code"><pre><code><font color="2100ae"><strong>2 3 4</strong></font> <font color="grey"><strong>+ *</strong></font>
</code></pre></div>

<p>&eacute;quivaut &agrave; l'expression arithm&eacute;tique 2 * (3 + 4) alors que le code
Forth suivant :</p>
<div class="code"><pre><code><font color="2100ae"><strong>2 3 4</strong></font> <font color="grey"><strong>* +</strong></font>
</code></pre></div>

<p>&eacute;quivaut &agrave; l'expression arithm&eacute;tique 2 + (3 * 4).</p>

<p>Si l'on d&eacute;sire afficher &agrave; l'&eacute;cran le r&eacute;sultat de l'op&eacute;ration on
  utilisera le mot Forth <strong>.</strong></p>
<div class="code"><pre><code><font color="2100ae"><strong>2 3 4</strong></font> <font color="grey"><strong>* + .</strong></font>
</code></pre></div>

<p>Le travail de l'interpr&eacute;teur Forth est assez trivial: il se
contente d'extraire les symboles &agrave; la vol&eacute;e (simplement de gauche &agrave;
droite), il empile les nombres qu'il rencontre et ex&eacute;cute les
op&eacute;randes (les mots Forth) consommant une certaine quantit&eacute; de donn&eacute;es
dans cette pile puis, si r&eacute;sultat il y a, empilera le r&eacute;sultat. La
section suivante expliquera mieux ce processus.</p>

<p>Si l'on d&eacute;sire cr&eacute;er un nouveau mot Forth, on utilisera le mot
Forth <font color="red"><strong>:</strong></font> suivi du nom du nouveau mot Forth puis d'une suite de
mots Forths connus ou de nombres et enfin du mot <font color="ff9900"><strong>;</strong></font> qui termine la
d&eacute;finition. Les mots : et ; sont des mots primitifs du langage (builtin).
L'interpr&eacute;teur Forth passe alors en mode compilation. Par exemple:</p>

<div class="code"><pre><code><font color="red"><strong>: MON-CALCUL</strong></font> <font color="2100ae"><strong>2 3 4</strong></font> <font color="grey"><strong>* +</strong></font> <font color="ff9900"><strong>;</strong></font> </code></pre></div>

<p>Il est clair que MON-CALCUL est un mot Forth inconnu et que si
l'interpr&eacute;teur tente de l'ex&eacute;cuter il &eacute;chouera. C'est l'ex&eacute;cution du
mot <strong>:</strong> qui va lui indiquer que le mot suivant (&agrave; savoir
MON-CALCUL) ne doit pas &ecirc;tre interpr&eacute;t&eacute; mais doit &ecirc;tre utilis&eacute;. Nous
reviendrons plus tard sur le fonctionnement exact avec les mots Forth
de hauts niveaux. Le mot MON-CALCUL a &eacute;t&eacute; compil&eacute; en byte-code et
d&eacute;sormais il est maintenant un mot connu. Nous y reviendrons dans une
section future.</p>

<div class="right"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></div></div>
<!-- Subsection: Forth un langage &agrave; piles -->
<a id="pile" name="pile"></a><h2><img class="icone20" src="icons/gear.png" alt=""/>Forth un langage &agrave; piles</h2>
<div class="boite"> 

<p>Le lecteur notera, dans le titre, l'utilisation du pluriel pour le
   mot pile. En informatique une
   <a href="https://fr.wikipedia.org/wiki/Pile_(informatique)" target="_blank">pile</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>
   (stack en anglais) est une structure pour stocker des &eacute;l&eacute;ments et
   par analogie avec la pile d'assiettes, c'est la derni&egrave;re assiette
   (derni&egrave;re donn&eacute;e) d&eacute;pos&eacute;e qu'on ira pr&eacute;lever en premier. Une pile
   est &eacute;galement nomm&eacute;e LIFO pour Last In First Out. Nous allons voir
   ici que Forth utilise deux piles: -- une pile pour les donn&eacute;es
   (nomm&eacute;e data stack ou bien S); -- une pile pour l'ex&eacute;cution des
   mots (nomm&eacute;e return stack ou bien R).</p>

<p>Des langages, tels que le C, cachent d&eacute;lib&eacute;r&eacute;ment au d&eacute;veloppeur
   l'utilisation d'une pile de contexte pour sauvegarder des
   informations. Par exemple, lorsque une fonction appelle une autre
   fonction, le compilateur va empiler:</p>

<!-- Begin List -->
<ul>
<li>les param&egrave;tres pass&eacute;s &agrave; la fonction,</li>
<li>les variables locales de
la fonction,</li>
<li>et bien d'autres encore comme le code de retour de la
fonction.</li>
</ul>
<!-- End list -->

<p>Ceci peut entra&icirc;ner des p&eacute;nalit&eacute;s en temps d'ex&eacute;cution du programme
(passage de trop de param&egrave;tres, passage des param&egrave;tres par copie au
lieu de leur adresse), voir des crashs par d&eacute;bordement de la pile
d'appels (stack overflow) ce qui peut arriver, par exemple, dans les
cas suivants: <!-- Begin List -->
<ul>
<li>soit en passant par copie des donn&eacute;es trop
grosses,</li>
<li>soit en utilisant la r&eacute;cursivit&eacute; sur des langages mal
adapt&eacute;s &agrave; la r&eacute;cursion terminale tels que le C.</li>
</ul>
<!-- End list -->
</p>

<p>Forth utilise deux types de piles: <!-- Begin List -->
<ul>
<li>une accessible au
d&eacute;veloppeur pour stocker les donn&eacute;es qui sont, en fait, les param&egrave;tres
des mots Forth;</li>
<li>une seconde utilis&eacute;e par l'interpr&eacute;teur pour
sauvegarder l'ordre des appels des mots. Nous verrons qu'elle est en
fait partiellement acc&eacute;ssible au d&eacute;veloppeur.</li>
</ul>
<!-- End list -->

<p><strong>Pile de donn&eacute;es:</strong> En Forth, avec la notation polonaise
invers&eacute;e, les op&eacute;randes sont directement stock&eacute;s dans une pile de
donn&eacute;es et les op&eacute;rateurs (les mot Forths) les consomment. Par
cons&eacute;quent, contrairement &agrave; des langages comme le C, la pile &eacute;vite &agrave;
Forth l'utilisation de variables temporaires nomm&eacute;es (&eacute;quivalent aux
variables locales du C). Ceci est &agrave; la fois un avantage et une
faiblesse du langage: le programmeur Forth doit organiser l'ordre des
&eacute;l&eacute;ments dans la pile avant leur consommation (avec des mots tels que
DUP, SWAP, OVER) ce qui ajoute du bruit au code source de
l'algorithme.  Certains Forth non-standards reprennent cette id&eacute;e de
variables locales nomm&eacute;es (comme le langage C): une partie de la pile
est transf&eacute;r&eacute;e dans ces variables pour une utilisation directe.</p>

<p>Supposons les piles S et R initialement vides puis ex&eacute;cutons le
code suivant:</p> <div class="code"><pre><code><font color="2100ae"><strong>2</strong></font> <font color="grey"><strong>DUP + .</strong></font>  </code></pre></div>

<!-- Begin List -->
<ul>
<li>L'interpr&eacute;teur va placer l'op&eacute;rande 2 dans la pile (qui aura donc
son premier &eacute;l&eacute;ment).</li>
<li>Le mot DUP va le consommer (d&eacute;piler) puis le dupliquer (DUPlicate en
anglais). La pile aura deux &eacute;l&eacute;ments.</li>
<li>Le mot + consommera les deux &eacute;l&eacute;ments de la pile (deux d&eacute;pilements)</li>
<li>les additionnera et empilera le r&eacute;sultat (soit la valeur
4).</li>
<li>Finalement le mot . va d&eacute;piler la valeur et affichera sa valeur &agrave;
l'&eacute;cran (&eacute;quivalent du stdout du C). La pile de donn&eacute;es se retrouve
dans son &eacute;tat d'origine (vide).</li>
</ul>
<!-- End list -->

<p>Il est de la responsabilit&eacute; du d&eacute;veloppeur de v&eacute;rifier qu'il y ait
toujours le bon nombre d'&eacute;l&eacute;ments dans la pile. Si un mot veut
consommer des &eacute;l&eacute;ments non pr&eacute;sents dans la pile, l'interpr&eacute;teur va
interrompre tout le programme et le signaler &agrave; l'utilisateur par un
message d'erreur.</p>

<p><strong>Notation des piles:</strong> TODO
D&eacute;s que le l'analyseur ex&eacute;cutera le mot ( il ignorera tous les mots
jusqu'&agrave; trouver le mot ) Notons qu'il existe un autre type de commentaire Forth
le mot \ ignore enti&egrave;rement la ligne courante.</p>
<div class="code"><pre><code> <font color="red"><strong>: par</strong></font> 41 WORD DROP <font color="ff9900"><strong>; immediate</strong></font>
</code></pre></div>

<p><strong>Pile de retour:</strong> cette pile est utilis&eacute;e pour m&eacute;moriser
l'ordre des appels des mots Forth appelant d'autres mots Forth. Pour
bien comprendre la raison de son existence, rappellons-nous des
algorithmes de parcours d'arbre. Sur la figure suivante,
nous souhaitons simuler un repas en parcourant les
noeuds de cet arbre avec un parcours pr&eacute;fixe main gauche
<a href="https://en.wikipedia.org/wiki/Tree_traversal" target="_blank">main-gauche</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>.</p>

<div class="centrer"><a href="tuto/forth/poulet-frite-arbre.png"><img class="caption" src="tuto/forth/poulet-frite-arbre.png" alt="picture"/></a><p>Votre repas pour ce midi.</p></div>

<p>Avant d'expliquer l'algorithme, voyons d'abord le r&eacute;sultat attendu
d'un parcours pr&eacute;fixe: <em>repas, entr&eacute;e, d&eacute;jeuner, poulet,
frites, d&eacute;sert</em>. Les mots <em>repas, d&eacute;jeuner</em> n'ont pas de
signification int&eacute;ressante, pour cela on ne gardera que les feuilles
de l'arbre (feuille est noeud ayant aucun fils), on
obtient alors: <strong>entr&eacute;e, poulet, frites, d&eacute;sert</strong>. Pour
obtenir ce r&eacute;sultat, on peut penser &agrave; deux algorithmes: -- l'un r&eacute;cursif, --
l'autre it&eacute;ratif.</p>

<p>Voyons d'abord la version r&eacute;cursive de l'algorithme d'un parcours
pr&eacute;fixe main gauche. Pour simplifier on supposera que l'arbre binaire (&agrave; savoir soit au max deux
sous-arbres par noeud), en effet, pour un arbre g&eacute;n&eacute;ral (comme sur la figure
pr&eacute;c&eacute;dente), on remplacera fils gauche/droit par le N-i&egrave;me fils:</p>

<div class="code"><pre><code>explorer(arbre A):
   afficher le noeud de A;
   si A a un fils gauche alors explorer(fils gauche de A) fin si;
   si A a un fils droit alors explorer(fils droit de A) fin si;
</code></pre></div>

<p>Cet algorithme utilise implicitement une pile pour sauvegarder les
noeuds parcourus. Le compilateur va g&eacute;rer automatiquement la pile d'appel
(Rappelez vous quand je disais que le langage C cachait au
d&eacute;veloppeur l'utilisation de cette pile). Maintenant, voyons comment est
g&eacute;r&eacute;e cette pile, en utilisant un algorithme it&eacute;ratif:</p>
<div class="code"><pre><code>explorer(arbre A):
   cr&eacute;er une pile vide;
   empiler(A);
   tant que la pile n'est pas vide faire:
       noeud <- d&eacute;piler;
       afficher noeud;
       si noeud a un fils gauche alors empiler(son fils gauche) fin si;
       si noeud a un fils droit alors empiler(son fils droit) fin si;
   fin tant que
</code></pre></div>

<p>Quel est le lien avec Forth ? L'interpr&eacute;teur Forth d&egrave;s qu'il lit un
nouveau symbole (mot) sur son entr&eacute;e va l'interpr&eacute;ter de fa&ccedil;on
similaire &agrave; notre algorithme d'exploration d'arbre &agrave; la diff&eacute;rence pr&egrave;s
qu'il ne se contentera pas d'afficher le noeud mais ex&eacute;cutera les
instructions assembleur du mot. La pile utilis&eacute;e est la pile de retour R
que l'on a introduit pr&eacute;c&eacute;demment.</p>

<p>On peut se poser une autre
question: quel est le lien entre un mot Forth est un arbre ?  Un mot
Forth connu de l'interpr&eacute;teur &agrave; implicitement une structure d'arbre.
Supposons que notre Forth connaisse les mots ENTREE, POULET, FRITES, DESERT.
Nous pouvons cr&eacute;er les mots suivants:</p>

<div class="code"><pre><code><font color="red"><strong>: DEJEUNER</strong></font> <font color="green"><strong>POULET FRITES</strong></font> <font color="ff9900"><strong>;</strong></font>
<font color="red"><strong>: REPAS</strong></font> <font color="green"><strong>ENTREE DEJEUNER DESERT</strong></font> <font color="ff9900"><strong>;</strong></font>
</code></pre></div>

<p>L'arbre g&eacute;n&eacute;ral qui &eacute;tait REPAS est devenu un arbre binaire dans
Forth et les noeuds qui avaient la m&ecirc;me hauteur sont maintenant li&eacute;s
entre eux.</p>

<div class="centrer"><a href="tuto/forth/poulet-frite-forth.png"><img class="caption" src="tuto/forth/poulet-frite-forth.png" alt="picture"/></a><p>Votre repas en Forth.</p></div>

<p>Cela sera plus clair pour le lecteur lorsque nous aborderons le chapitre sur le
dictionnaire de l'interpr&eacute;teur car nous n'avons pas encore abord&eacute; comment les mots Forth sont
repr&eacute;sent&eacute;s en m&eacute;moire (chapitre suivant), pour le moment le lecteur doit accepter
le fait que les fils gauches sont une addresse vers l'emplacement m&eacute;moire
d'un autre mot Forth et que les fils droits n'existent pas, ils sont
implicites car les noeuds sont plac&eacute;s cons&eacute;cutivement dans la m&eacute;moire
(par exemple ENTREE, DEJEUNER et DESSERT sont cons&eacute;cutifs en m&eacute;moire).</p>

<p>Maintentant, avec cet arbre binaire, si l'on &eacute;x&eacute;cute uniquement les noeuds qui n'ont pas de fils gauche, on obtiendra le
r&eacute;sultat attendu: <strong>ENTREE, POULET, FRITES, DESERT</strong>. On comprendra mieux par la suite</p>

<p>Comment est impl&eacute;ment&eacute; les piles ainsi que le parcours d'arbres des mots
en Forth ? Deux r&eacute;ponses d&eacute;pendants du langage qui impl&eacute;mente l'interpr&eacute;teur Forth:</p>

<!-- Begin List -->
<ul>
<li><strong>Assembleur:</strong> Forth &eacute;tant un langage pour les
micro-contr&ocirc;leur, les mots primitifs du langage (&agrave; savoir les mots
constituants le coeur du syst&egrave;me) <em>pointent</em> sur du code
assembleur, une des piles utilise le registre de la pile interne aux
micro-contr&ocirc;leur, l'autre pile doit &ecirc;tre g&eacute;r&eacute;e explicitement. noeud
est le registre PC et il faut un registre d'interpr&eacute;tation IP qui se
d&eacute;place automatiquement et ex&eacute;cute les instructions assembleurs des
mots. L'existence des fils est g&eacute;r&eacute; par le mot Forth sp&eacute;cial RETURN
qui doit &ecirc;tre <em>coll&eacute;</em> aux mots primitifs. Je conseille le
tutoriel de
<a href="http://git.annexia.org/?p=jonesforth.git;a=blob;f=jonesforth.S;h=45e6e854a5d2a4c3f26af264dfce56379d401425;hb=HEAD" target="_blank">JonesForth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>
pour plus de renseignements.</li>
<li>Dans un langage de haut niveau tel que
le C: pour un soucis de portabilit&eacute; les piles seront &eacute;mul&eacute;es par un
tableau et les registres IP et PC seront &eacute;mul&eacute;s par un switch case.</li>
</ul>
<!-- End list -->

<p><strong>Note:</strong> les d&eacute;butants peuvent ignorer cette remarque dans
un premier temps, le pile de retourn est en fait partiellement accessible au
d&eacute;veloppeur mais cela peut pr&eacute;senter un risque de crash du programme. En effet
cette pile est utilis&eacute;e en m&ecirc;me temps &agrave; la fois par l'interpr&eacute;teur et le
d&eacute;veloppeur. Il existe des mots Forth permettant de d&eacute;placer temporairement des
nombres de la pile de donn&eacute;es sur la pile de retour >R et R> mais il faudra
faire attention &agrave; laisser la d&eacute;finition propre sous peine de faire crasher l'interpr&eacute;teur (interpr&eacute;tation, lors
du parcours d'arbre, du nombre transf&eacute;r&eacute; de la pile de donn&eacute;es &agrave; la
pile de retour). Pour cela il faut que le nombre mot >R et R> soient balanc&eacute;s.

<p><strong>Piles auxiliaires:</strong> Pour &eacute;viter les crashs avec les mots >R et R>
certains Forth les ont interdit et rend priv&eacute;e l'acc&egrave;s &agrave; la pile de retour. En contre-partie,
il est propos&eacute; &agrave; l'utilisateur une seconde pile de stockage des donn&eacute;es. De plus les Forth initiaux
ne manipulent pas de nombres floattants: ils sont &eacute;mul&eacute;s et utilisent la pile de donn&eacute;es. C'est
pour cela que certains Forth ont une pile qui leur est sp&eacute;cialement d&eacute;di&eacute;e. Par cons&eacute;quent un Forth
non-standard peut avoir jusqu'&agrave; quatre piles.</p>

<div class="right"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></div></div>
<!-- Subsection: Dictionnaire Forth: une machine virtuelle -->
<a id="dico" name="dico"></a><h2><img class="icone20" src="icons/gear.png" alt=""/>Dictionnaire Forth: une machine virtuelle</h2>
<div class="boite"> 

<p>Pour r&eacute;sumer ce qu'on l'a vu, Forth est un langage extensible
(tiss&eacute;): &agrave; partir de quelques mots de base on peut cr&eacute;er un nouveau
mot plus &eacute;volu&eacute;. Par exemple, le code suivant:</p>

<div class="code"><pre><code><font color="red"><strong>: SQUARE</strong></font> <font color="grey"><strong>DUP *</strong></font> <font color="ff9900"><strong>;</strong></font>
</code></pre></div>

<p>Permet de d&eacute;finir un nouveau mot Forth SQUARE via les mots : et ;
(qui jouent le r&ocirc;le de d&eacute;but et de fin de d&eacute;finition). Une fois ce mot
d&eacute;fini, il sera reconnu en tant que mot Forth valide par l'interpr&eacute;teur. Dans
notre cas, quand SQUARE sera ex&eacute;cut&eacute;, il calculera la puissance deux
du nombre stock&eacute; dans la pile. Par exemple, le code suivant, consommera le nombre
5 pos&eacute; de la pile et affichera le nombre 25.</p>

<div class="code"><pre><code><font color="2100ae"><strong>5</strong></font> <font color="green"><strong>SQUARE</strong></font> <font color="grey"><strong>.</strong></font>
</code></pre></div>

<p>Nous avons &eacute;galement vu que l'ex&eacute;cution de mots
Forth se rapproche d'un parcours d'arbre. Cette section fait enfin
ce lien, en expliquant comment les mots Forth sont stock&eacute;s en m&eacute;moire
et se r&eacute;f&egrave;rent entre eux.</p>

<p>Les mots Forth et leur d&eacute;finition sont stock&eacute;s dans une structure
de donn&eacute;e appel&eacute;e par convention le <em>dictionnaire</em> (dictonary en
anglais). un mot Forth stock&eacute; dans ce dictionnaire sera reconnu par l'interpr&eacute;teur.
La norme Forth laisse libre son impl&eacute;mentation. Regardons la
structure originelle du Forth pens&eacute;e par son auteur.</p>

<p>Le dictionnaire est un segment m&eacute;moire et peut &ecirc;tre vu comme le
ruban infini d'Alan Turing. Il est divis&eacute; en cases m&eacute;moire cons&eacute;cutives et par
convention on les nomme cellule (cell en anglais). Leur taille en
octets d&eacute;pend de l'architecture de la cible. Nous nous baserons pour
ce document sur une architecture 16-bits, donc un mot sera cod&eacute; sur deux octets.
Par cons&eacute;quent la taille d'un dictionnaire est 2<sup>16</sup>-1 soit 64 Ko (ce qui
est suffisant pour stocker un programme Forth). Pour rappel Forth &eacute;tant n&eacute; dans les
ann&eacute;es 70, il est tr&eacute;s adapt&eacute; pour ces tailles de mots et est
moins bien adapt&eacute; pour des architectures 32 ou 64-bits, &agrave; cause des
alignements des adresses m&eacute;moires et du padding implicite.</p>

<p>Voici la structure m&eacute;moire d'un mot Forth:</p>
<div class="code"><pre><code>                  &lt;----------            Ent&ecirc;te        ---------->
 - - - -----------+---------------+------+------------------------+----------- - - - + - - - - - - -
Fin mot pr&eacute;c&eacute;dent | <font color="2100ae"><strong>Taille, flags</strong></font> | <font color="red"><strong>Nom</strong></font>  | Pointeur mot pr&eacute;c&eacute;dent | <font color="green"><strong>D&eacute;f</strong></font><font color="grey"><strong>inition</strong></font>       | D&eacute;but mot suivant
 - - - -----------+---------------+------+------------------------+----------- - - - + - - - - - - -

                  ^                      ^                        ^     ^
                  |                      |                        |     |
                 NFA                    LFA                      CFA   PFA
</code></pre></div>

<!-- Begin List -->
<ul>
<li>Les informations <strong>Taille, Flags</strong> sont cod&eacute;es sur 1
seul octet.

<!-- Begin List -->
<ul>
<li><strong>Taille:</strong> code sur les 5 bits de poids faible, le nombre de
caract&egrave;res ASCII du nom du mot Forth;</li>
<li><strong>Flags:</strong> code sur les 3 bits de poids fort les informations
suivantes:

<!-- Begin List -->
<ul>
<li><strong>Smudge bit :</strong> indique si le mot doit &ecirc;tre ignor&eacute; lors
d'une recherche dans le dictionnaire. Ce drapeau est plac&eacute; dans deux
cas : -- soit l'utilisateur a d&eacute;cid&eacute; de supprimer le mot (avec le mot FORGET);
-- soit d'une d&eacute;finition avort&eacute;e (l'utilisateur a fait une erreur comme une
typo sur un mot de la d&eacute;finition qui n'a donc pas aboutie).;</li>
<li><font color="ff9900"><strong>immediat bit :</strong></font> si le mot doit &ecirc;tre imm&eacute;diatement interpr&eacute;t&eacute;
(ex&eacute;cut&eacute;) d&eacute;s que l'interpr&eacute;teur le lit</li>
<li>et ce</li>
<li>m&ecirc;me si l'int&eacute;rpr&eacute;teur
est entrain de compiler un nouveau mot. Le seul mot Forth imm&eacute;diat que l'on
conna&icirc;t &agrave; ce niveau du document est le mot <font color="ff9900"><strong>;</strong></font> qui termine la d&eacute;finition
d'un mot (et acc&eacute;ssoirement finalise le Smudge bit). S'il n'avait pas &eacute;t&eacute;
imm&eacute;diat l'interpr&eacute;teur l'aurait ajout&eacute; dans la d&eacute;finition du mot en cours.
Il faut pouvoir indiquer au compilateur quand s'arr&ecirc;ter.;</li>
<li>et le dernier bit toujours &agrave; 1 servant de s&eacute;parateur entre les entr&eacute;es
du dictionnaire (soit valant 80 en base 16). Il permet de retrouver le
d&eacute;but de d&eacute;finition d'un mot et donc de pouvoir s&eacute;parer plus facilement
les mots entre eux.</li>
</ul>
<!-- End list -->
</li>
</ul>
<!-- End list -->
</li>
<li><strong>Nom :</strong> est le nom du mot Forth et le nombre de charact&egrave;re ASCII cons&eacute;cutifs est
variable et est donn&eacute; par l'information <strong>Taille:</strong>. Le nombre max de caract&egrave;re
est donc 2<sup>5</sup>-1.</li>
<li>Pointeur vers le mot pr&eacute;c&eacute;dent: <strong>LINK POINTER :</strong> est
l'adresse de l'entr&eacute;e pr&eacute;c&eacute;dente du dictionnaire. Les mots Forth sont
stock&eacute;s dans le dictionnaire comme une liste simplement cha&icirc;n&eacute;e et dont l'interpr&eacute;teur
maintient automatiquement la t&ecirc;te de la liste. L'interpr&eacute;teur peut ainsi savoir si
un mot existe. Les adresses peut &ecirc;tre relatives ou absolues (la
premi&egrave;re ayant la bonne propri&eacute;t&eacute; de permettre de d&eacute;placer un bloc
m&eacute;moire du dictionnaire sans devoir changer l'ensemble des adresses). Le nombre
d'octets d'une adresse d&eacute;pend de l'architecture choisie,ici 16
bits et par cons&eacute;quent la taille d'un dictionnaire est
2<sup>16</sup>-1 soit 64 Ko.</li>
<li><strong>D&eacute;finition :</strong> est une suite d'adresses pointant sur les mots
d&eacute;j&agrave; existants du dictionnaire, que l'on nommera par convention Code
Field Address (CFA).</li>
</ul>
<!-- End list -->

<p>Certaines adresses sont importantes en Forth et poss&egrave;dent un nom :</p>
<!-- Begin List -->
<ul>
<li><strong>NFA:</strong> Name Field Address pointe sur l'entr&eacute;e d'un
mot;</li>
<li><strong>LFA:</strong> Link Field Address pointe sur l'emplacement contenant
l'adresse du mot pr&eacute;c&eacute;dent. On rappelle qu'elle sert &agrave; parcourir les
entr&eacute;es du dictionnaire et savoir si un mot est connu de
l'interpr&eacute;teur. Les mots qui ont leur Smudge bit;</li>
<li><strong>CFA:</strong> Code Field Address pointe sur le d&eacute;but de la
d&eacute;finition d'un mot. Il ne faut pas le confondre avec LFA car il sert
&agrave; d&eacute;placer le pointeur d'interpr&eacute;tation de l'interpr&eacute;teur (pointeur
sur le mot &agrave; interpr&eacute;t&eacute;). Il faut le voir comme une sorte
d'identifiant sur les mots sorte de bytecode/opcode d'une machine
virtuelle java;</li>
<li><strong>PFA:</strong> Parameter Field Address pointe sur le second
emplacement de la d&eacute;finition.</li>
</ul>
<!-- End list -->

<p>A partir d'un CFA donn&eacute;, gr&acirc;ce au bit toujours mis &agrave; 1, il est
possible d'atteindre le d&eacute;but de l'entr&eacute;e en d&eacute;cr&eacute;mentant la valeur de
l'adresse et en appliquant au contenu de l'adresse l'op&eacute;ration OU
bit &agrave; bit avec la valeur hexad&eacute;cimale 80.</p>

<p><img class="icone30" src="icons/construction.gif" alt="EN CONSTRUCTION"/> Le script suivant :</p>
<div class="code"><pre><code><font color="red"><strong>: CFA</strong></font> <font color="green"><strong>2</strong></font> <font color="grey"><strong>-</strong></font> <font color="ff9900"><strong>;</strong></font> <font color="grey"><strong>( PFA -- CFA)</strong></font>
<font color="red"><strong>: LFA</strong></font> <font color="green"><strong>2</strong></font> <font color="grey"><strong>-</strong></font> <font color="ff9900"><strong>;</strong></font> <font color="grey"><strong>( CFA -- LFA)</strong></font>
<font color="red"><strong>: NFA</strong></font> <font color="grey"><strong>( CFA -- LFA)</strong></font>
FIXMEEEEEEEEEEEEE
<font color="green"><strong>2</strong></font> <font color="grey"><strong>-</strong></font> <font color="ff9900"><strong>;</strong></font>
</code></pre></div>

<p>Il faut distinguer deux types de mots Forth:
<!-- Begin List -->
<ul>
<li>Les mots primitifs qui sont pr&eacute;sents dans le coeur du langage et qui appellent le code
ex&eacute;cutable soit assembleur soit en C. Par exempl le mot DUP appelera l'assembleur i386
<div class="code"><pre><code>
mov (%esp),%eax  // duplicate top of stack
push %eax
</code></pre></div></li>
<li>Les mots non primitifs d&eacute;finis par les mots Forth :</li>
</ul>
<!-- End list -->
</p>

<p>Le script suivant :</p>
<div class="code"><pre><code><font color="red"><strong>:  SQR</strong></font> <font color="grey"><strong>DUP *</strong></font> <font color="ff9900"><strong>;</strong></font>
<font color="red"><strong>: .SQR</strong></font> <font color="green"><strong>SQR</strong></font> <font color="grey"><strong>.</strong></font> <font color="ff9900"><strong>;</strong></font>
</code></pre></div>

<p>va cr&eacute;er deux nouvelles entr&eacute;es dans le dictionnaire comme indiqu&eacute;
dans la figure ci-dessous :</p>
<div class="code"><pre><code>                   +--------------------+
                   |              +---- | ------------------------------------------+-------------+
                   v              v     |                                           |             |
---------------- - - - ---------------- | ----------------------------------------- | ------------|------------
| <font color="2100ae"><strong>0x81</strong></font> | <font color="grey"><strong>DUP</strong></font> |          | <font color="2100ae"><strong>0x83</strong></font> | <font color="red"><strong>SQR</strong></font> |     | <font color="red"><strong>DOCOL</strong></font> | <font color="grey"><strong>DUP</strong></font> | <font color="grey"><strong>*</strong></font> | <font color="ff9900"><strong>EXIT</strong></font> | <font color="2100ae"><strong>0x84</strong></font> | <font color="red"><strong>.SQR</strong></font> |    | <font color="red"><strong>DOCOL</strong></font> | <font color="green"><strong>SQR</strong></font> | <font color="green"><strong>.</strong></font> | <font color="ff9900"><strong>EXIT</strong></font>
---------------- - - - ------------------------|------|----|----|--------------------------|-------------------
         ^                                     |      |    |    |                          |
         |                     &lt;-- - - - ------+      |    |    v                          v
         +--------------------------------------------+----+
</code></pre></div>

<p>Regardons comment l'interpr&eacute;teur ex&eacute;cute le script:</p>
<div class="code"><pre><code><font color="green"><strong>: FOO</strong></font> * * <font color="ff9900"><strong>;</strong></font>
</code></pre></div>
<p>Il execute le mot :, active l'interpr&eacute;teur en mode compilation.
Celui-ci va stocker en fin de dictionnaire les CFA des mots.
: cr&eacute;e l'ent&ecirc;te avec le mot suivant 0x83 FOO DOCOL ainsi que le pointeur du mot
pr&eacute;c&eacute;dent. L'interpr&eacute;teur lit le mot * et place son CFA en fin de dictionnaire.
Idem pour le deuci&egrave;me *. Enfin il lit le mot ; qui doit &ecirc;tre imm&eacute;diatement ex&eacute;cut&eacute;,
ce mot finalise la d&eacute;finition du mot (smudge bit, met a jout LAST) puis remet
l'interpr&eacute;teur en mode execution.</p>

<p>Les fl&egrave;ches repr&eacute;sentent les adresses (LFA ou CFA) vers les mots
existants du dictionnaire. Vu que BAR a &eacute;t&eacute; ins&eacute;r&eacute; dans le
dictionnaire apr&egrave;s FOO son LFA pointe vers FOO et le dictionnaire
m&eacute;morise son LFA pour faire ses recherches sur les mots existants (la
fameuse liste chain&eacute;e).</p>

<p>Les litt&eacute;raux 0x81, 0x83 (notation base 16) sont les tailles des
mots avec le marqueur de s&eacute;paration des entr&eacute;es du dictionnaire. Les
mots Forth DOCOL et EXIT sont des mots particuliers que l'on d&eacute;crira
plus tard. HERE pointe sur l'emplacement apr&egrave;s EXIT du mot BAR.</p>

<p>Le dictionnaire poss&egrave;de deux informations suppl&eacute;mentaires qui sont
eux-m&ecirc;mes des mots Forth (donc aussi stock&eacute;s dans le
dictionnaire) :</p>

<!-- Begin List -->
<ul>
<li>le LFA du dernier mot ins&eacute;r&eacute; dans le dictionnaire. C'est le mot
Forth LAST (anciennement nomm&eacute; LATEST) qui joue ce r&ocirc;le;</li>
<li>le premier emplacement libre du dictionnaire pour prochain mot est
donn&eacute; par le mot Forth HERE. HERE est mis &agrave; jour automatiquement apr&egrave;s
l'insertion d'une entr&eacute;e ou d'un CFA. Il existe sur certain Forth un
mot Forth appel&eacute; DP pour Dictionary Pointer, faisant partie des
variables utilisateur, qui permet de changer l'emplacement indiqu&eacute;
par HERE (comme une t&ecirc;te de lecture/&eacute;criture).</li>
</ul>
<!-- End list -->

<p>A chaque fois qu'un mot est ins&eacute;r&eacute; &agrave; la d&eacute;finition d'un mot, c'est
le mot HERE qui indique l'emplacement. Apr&egrave;s l'ajout du mot, HERE est
automatiquement d&eacute;plac&eacute; pour toujours pointer sur un emplacement
libre mais des mots comme ALLOC permettant de r&eacute;server de la m&eacute;moire
d&eacute;place simplement HERE.</p>

<p>Deux avantages de cette structure de donn&eacute;e sont :</p>
<!-- Begin List -->
<ul>
<li>la non segmentation de la m&eacute;moire : d&eacute;placer un bloc d'entr&eacute;e en
m&eacute;moire est trivial (surtout si les adresses sont relatives et non
absolues; on pensera &agrave; la concat&eacute;nation de dictionnaires entre eux).;</li>
<li>La recherche s'arr&ecirc;tant au premier mot trouv&eacute;</li>
<li>on peut donc &eacute;craser une ancienne
d&eacute;finition comme il suit :</li>
</ul>
<!-- End list -->

<div class="code"><pre><code><font color="green"><strong>: FOO</strong></font> * * <font color="ff9900"><strong>;</strong></font>
<font color="green"><strong>: BAR</strong></font> FOO . <font color="ff9900"><strong>;</strong></font>
<font color="green"><strong>: FOO</strong></font> + + <font color="ff9900"><strong>;</strong></font>
<font color="green"><strong>: BAR</strong></font> FOO . <font color="ff9900"><strong>;</strong></font>
</code></pre></div>

<p>Interpr&eacute;ter BAR appellera deux additions.</p>

<p>L'inconv&eacute;nient majeur de cette structure de donn&eacute;e est que la
recherche se fait avec une complexit&eacute; lin&eacute;aire que l'on note
O(n). Pour palier &agrave; ce probl&egrave;mes des mots Forth de m&ecirc;me nature peuvent
&ecirc;tre regroup&eacute;s en vocabulaires. Le vocabulaire est l'anc&ecirc;tre des
espaces de nommage des langages modernes (comme en C++ avec par
exemple std::cout). Un vocabulaire est un mot Forth g&eacute;rant un index de
LAST mais pointant sur des mots choisis par le d&eacute;veloppeur. On a donc
une sorte d'arbre o&ugrave; une recherche partirait d'un feuille (d'un
vocabulaire sp&eacute;cifi&eacute;, donc un mot &eacute;quivalent &agrave; LAST) et se terminerait
&agrave; la racine de l'arbre.</p>

<p>Moore avec son colorForth est pass&eacute; &agrave; une table de hachage et pour
sauver de la m&eacute;moire il compresse les noms des mots Forth avec un
codage de Huffman.</p>

<p>Rappelons qu'un des flags dans l'ent&ecirc;te d'une entr&eacute;e indique si le
mot est valide ou non (c'est le smudge bit). S'il est mis, alors il
sera ignor&eacute; lors d'une recherche. Le mot FORGET suivit d'un mot
existant (par exemple FORGET FOO) permet de tronquer toutes les
d&eacute;finitions du dictionnaire jusqu'&agrave; ce mot. FORGET change simplement
la valeur de LATEST. On prendra garde &agrave; ne pas supprimer tout le
dictionnaire en tentant par exemple de supprimer le premier mot du
dictionnaire.</p>

<p>Forth se pr&ecirc;te bien &agrave; la r&eacute;cursivit&eacute; : une r&eacute;cursivit&eacute; terminale
n'est rien d'autre qu'un saut en m&eacute;moire. Malheureusement, la syntaxe
varie fortement d'un Forth &agrave; un autre. En effet, selon le Forth
utilis&eacute;, lorsqu'une ent&ecirc;te est cr&eacute;&eacute;e dans le dictionnaire LATEST ne
pointe pas encore dessus, d'autre Forth, le smudge bit est mis tant
que le mot ; n'est pas ex&eacute;cut&eacute; effa&ccedil;ant le bit. Le mot SMUDGE doit
&ecirc;tre utilis&eacute; dans la d&eacute;finition pour commuter le flag en question.</p>

<p>Voici un exemple de r&eacute;cursivit&eacute; :</p>
<div class="code"><pre><code><font color="green"><strong>: FACTORIELLE</strong></font>
 DUP <font color="red"><strong>1</strong></font> >
  <font color="2100ae"><strong>IF</strong></font>
   DUP <font color="red"><strong>1</strong></font> - FACTORIELLE *
 <font color="2100ae"><strong>THEN</strong></font> <font color="ff9900"><strong>;</strong></font>
</code></pre></div>

<p>Les premiers Forth l'impl&eacute;mentent comme une liste cha&icirc;n&eacute;e o&ugrave; tous les
mots sont stock&eacute;s les uns &agrave; la suite des autres (sans trous); certains
Forth s&eacute;parent les entr&eacute;es des d&eacute;finitions (index s&eacute;par&eacute;) tout en
gardant le principe de liste cha&icirc;n&eacute;e entre les mots; d'autres
utilisent une table de hachage, etc.</p>

<div class="right"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></div></div>
<!-- Subsection: Diff&eacute;rentes classes de mots -->
<a id="class" name="class"></a><h2><img class="icone20" src="icons/gear.png" alt=""/>Diff&eacute;rentes classes de mots</h2>
<div class="boite"> 

  N&eacute;anmoins Forth offre la possibilit&eacute; d'utiliser des
constantes et des variables mais qui doivent &ecirc;tre vues comme des noms
sur des emplacements m&eacute;moire de longue dur&eacute;e (&eacute;quivalent aux globales
du C) &agrave; savoir que leur dur&eacute;e de vie est li&eacute; &agrave; celle du programme.</p>

<p>Je d&eacute;cris rapidement les diff&eacute;rents cat&eacute;gories de mot sachant que
le lien <a href="https://www.forth.com/starting-forth/" target="_blank">Starting Forth</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>
les expliquera mieux :</p>

<!-- Begin List -->
<ul>
<li>Gestion des piles</li>
<li>gestion
num&eacute;rique</li>
<li>arithm&eacute;tique</li>
<li>structure de contr&ocirc;le</li>
<li>action sur la
m&eacute;moire</li>
<li>gestion des entr&eacute;es-sorties</li>
<li>conversion</li>
<li>mots de haut niveau</li>
</ul>
<!-- End list -->

<p><strong>Commentaires :</strong> il existe deux types de commentaires en
Forth. Le premier type est le mot Forth imm&eacute;diat <font color="ff9900"><strong>&#40;</strong></font> qui
ignore tout caract&egrave;re jusqu'au premier caract&egrave;re &#41;
rencontr&eacute;. Par cons&eacute;quent il est donc impossible d'imbriquer des
commentaires entre-eux. Et il ne faut pas oublier les espaces car
&#40; est un mot Forth comme un autre. Ce type de commentaire est
pr&eacute;f&eacute;r&eacute; pour indiquer les param&egrave;tres d'un mot Forth. Pour plus de
renseignements sur la norme de la notation des param&egrave;tres
<a href="http://www.forth.org/forth_style.html" target="_blank">voir ce site</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>.</p>
<div class="code"><pre><code>: DIVISION ( n1 n2 -- n1/n2 ) / ;
</code></pre></div>

<p>Indique que DIVISION va consommer deux nombres sign&eacute;s o&ugrave; n1 est
d&eacute;pos&eacute; dans la pile avant n2 (dans l'ordre de gauche &agrave; droite) et
retourner le r&eacute;sultat dans la pile. Pour preuve <font color="red"><strong>1 0</strong></font> DIVISION doit
retourner une exception tentative de division par z&eacute;ro.</p>

<p>Le deuxi&egrave;me type de commentaire (ajout&eacute; tardivement) est le mot
<font color="ff9900"><strong>&#92;</strong></font> qui ignore la ligne enti&egrave;re. Il est utilis&eacute; pour de
vrais commentaires autre que le renseignements de param&eacute;tres.</p>

<p><strong>Gestion de la pile :</strong> permet de commuter l'ordre des donn&eacute;es
dans la pile. Par exemple DUP duplique le sommet, DROP le supprime,
SWAP permute le sommet de la pile avec l'avant dernier, le mot
. consomme et affiche le sommet de la pile, etc.</p>

<p><strong>M&eacute;moire :</strong> Le mot @ permet d'acc&eacute;der au contenu d'une
adresse. Le mot ! permet de stocker une valeur dans une adresse. Une
  variable en Forth est une m&eacute;moire nomm&eacute;e. Exemple :</p>
<div class="code"><pre><code>15 VARIABLE TOTO
TOTO @ .
14 TOTO !
: ? @ . ;
TOTO ?
</code></pre></div>
<p>La premi&egrave;re ligne cr&eacute;&eacute; une variable nomm&eacute;e TOTO avec la valeur
15. La deuxi&egrave;me ligne permet d'acc&eacute;der au contenu de la variable puis
l'affiche. La troisi&egrave;me ligne change la valeur de TOTO avec la valeur
14. La quatri&egrave;me ligne cr&eacute;e un mot couramment utilis&eacute;. La derni&egrave;re
affichera la valeur 14.</p>

<p><strong>Base :</strong> Forth permet d'afficher les nombres dans la base
d&eacute;sir&eacute;e. Exemple amusant :</p>
<div class="code"><pre><code>: HEX 16 BASE ! ;
a .
HEX
BASE ?
a .
10 BASE !
BASE
a .
</code></pre></div>

<p>La premi&egrave;re ligne red&eacute;finit un mot courant du Forth permettant de
passer en base 16 (hexad&eacute;cimal). Par d&eacute;faut Forth est en base 10
(d&eacute;cimale) donc la deuxi&egrave;me ligne doit g&eacute;n&eacute;r&eacute;e une erreur
(l'utilisateur voulait empiler le nombre a en base 16 (valant 10 en
base 10) mais comme nous sommes en base 10 Forth d&eacute;tecte que ce mot
lui est inconnu. Les lignes 3 &agrave; 5 permet de v&eacute;rifier que nous sommes
en base 16, la ligne 5 ne doit plus g&eacute;n&eacute;rer d'erreur. Ligne 7 &agrave; 9,
l'utilisateur tente na&iuml;vement de repasser en base d&eacute;cimale mais cela
&eacute;choue car le nombre 10 est interpr&egrave;te en base hexad&eacute;cimale valant 16
en base d&eacute;cimale. Donc il n'y a pas eu de changement de base</p>

<p><strong>Mots de structure :</strong> les classiques structures de contr&ocirc;le
connues des autres langages (comme le C) sont : le test conditionnel
if-then-else, la boucle do-loop, la boiucle for, etc. Comme Forth
utilise le syst&egrave;me polonais invers&eacute; m&ecirc;me le if-then-else du C devient
IF ELSE THEN. Cela peut perturber le d&eacute;butant mais on peut renommer
THEN par FI ou ENDIF ce qui aidera les d&eacute;butants.</p>
<div class="code"><pre><code><font color="green"><strong>: ENDIF</strong></font> <font color="ff9900"><strong>&#91;COMPILE&#93; THEN ; IMMEDIATE</strong></font>
</code></pre></div>

<p>De plus IF ELSE THEN doivent obligatoirement &ecirc;tre utilis&eacute;s dans une
d&eacute;finition sinon le compilateur &eacute;chouera. En mode interpr&eacute;tation if
faudra utiliser les mots IF ELSE THEN qui &eacute;quivaut au #if #else
#endif du langage C. Le lien
<a href="https://www.rfc1149.net/download/documents/ifi/forth.pdf" target="_blank">suivant</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/>
explique en quoi Moore a encore r&eacute;duit le nombre de mots de
structure. Par exemple le ELSE n'existe plus. Avant :</p>
<div class="code"><pre><code><font color="green"><strong>: MOT</strong></font> TEST <font color="2100ae"><strong>IF</strong></font> ACTION1 <font color="2100ae"><strong>ELSE</strong></font> ACTION2 <font color="2100ae"><strong>THEN</strong></font> ACTION3 ;
</code></pre></div>

<p>Devient :</p>
<div class="code"><pre><code><font color="green"><strong>: SOUS-MOT</strong></font> TEST <font color="2100ae"><strong>IF</strong></font> ACTION1 EXIT <font color="2100ae"><strong>THEN</strong></font> ACTION2 ;
<font color="green"><strong>: MOT</strong></font> SOUS-MOT ACTION3 ;
</code></pre></div>

<p><strong>Arithm&eacute;tique :</strong> addition, conversion entier sign&eacute; et non
sign&eacute;, op&eacute;ration bool&eacute;enne. Point important : contrairement &agrave; des
langage tel que C o&ugrave; le faux vaut 0 et le vrai vaut toutes valeurs
diff&eacute;rentes de 0 (mais o&ugrave; 1 est en g&eacute;n&eacute;ral retourn&eacute;), en forth le faux
vaut -1. Le <a href="http://wiki.c2.com/?BooleanRepresentation" target="_blank">lien</a> <img src="icons/externallink.png" height="12" width="12" border="0" alt="extlink"/> en
parle plus longuement. Sinon, voici un exemple :</p> <div class="code"><pre><code><font color="red"><strong>1 0</strong></font> &#60;&#62; . </code></pre></div>

<p>La pile de donn&eacute;es des Forth permet uniquement de manipuler des
entiers (sign&eacute;s et non sign&eacute;s) ou des adresses de la machine virtuelle
(qui sont finalement vues comme un entier), les valeurs en floatants
(float et double du langage C) ne sont pas g&eacute;r&eacute;es nativement, une
biblioth&egrave;que devant alors &ecirc;tre charg&eacute;e pour les g&eacute;rer.</p>

<p>En fait, par d&eacute;faut, Forth n'utilise pas une seule pile mais deux
piles. La deuxi&egrave;me, appel&eacute;e pile de retour, sert &agrave; l'interpr&eacute;teur
Forth pour m&eacute;moriser l'ordre d'ex&eacute;cution des mots appelant d'autres
mots. Cette pile est automatiquement manipul&eacute;e par lui mais laisse,
quand m&ecirc;me, &agrave; l'utilisateur la possibilit&eacute; de d&eacute;placer et stocker
temporairement des &eacute;l&eacute;ments de la pile de donn&eacute;es (ce qui n'est pas
toujours sans risque). Nous y reviendrons plus tard.</p>

<p>Des Forth modernes peuvent ajouter nativement des piles de donn&eacute;es
suppl&eacute;mentaires comme une pile d'entiers (appel&eacute;s pile alternative)
et/ou une pile des floatants. En g&eacute;n&eacute;ral, la pile de donn&eacute;e
suppl&eacute;mentaire permet d'&eacute;viter l'utilisation de la pile de retour
comme stockage temporaire et rendant l'interpr&eacute;teur Forth plus fiable
aux erreurs de programmation.</p>

<p>Un syst&egrave;me de s&eacute;curit&eacute; permet de v&eacute;rifier que les piles ne
d&eacute;bordent pas (par le haut ou par le bas) et pr&eacute;vient l'utilisateur en
arr&ecirc;tant l'ex&eacute;cution du mot en cours. Charles H. Moore quand &agrave; lui
pr&eacute;f&egrave;re utiliser un tampon circulaire par rapport &agrave; une pile. Il n'y a
plus de risque possible de d&eacute;bordement de m&eacute;moire mais il n'a pas
ajout&eacute; de syst&egrave;me pour pr&eacute;venir l'utilisateur car selon lui le
d&eacute;veloppeur doit ma&icirc;triser le nombre d'op&eacute;randes qu'il manipule. De
plus, ce syst&egrave;me permet de d&eacute;cider &agrave; tout instant la pile comme &eacute;tant
vide.</p>

<p>On constatera apr&egrave;s l'ex&eacute;cution du dernier exemple, que la
profondeur de pile des donn&eacute;e n'a pas &eacute;t&eacute; chang&eacute;e. Ceci n'est pas une
contrainte mais le standard Forth impose de laisser intact la
profondeur des piles pour au moins deux cas :</p> <!-- Begin List -->
<ul>
<li>lors des
d&eacute;finitions d'un nouveau mot Forth</li>
<li>et la fin d'un fichier quand il
est inclus par un autre fichier.</li>
</ul>
<!-- End list -->

<div class="right"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></div></div>
<!-- Subsection: Fonctionnement de interpr&eacute;teur externe -->
<a id="interpret" name="interpret"></a><h2><img class="icone20" src="icons/gear.png" alt=""/>Fonctionnement de interpr&eacute;teur externe</h2>
<div class="boite"> 

<p>Un interpr&eacute;teur Forth fonctionne tr&egrave;s simplement : tant que le flux
d'entr&eacute;e n'est pas fini, les mots sont lus les uns apr&egrave;s les
autres. L'interpr&eacute;teur poss&egrave;de deux modes : soit il est mode
ex&eacute;cution, soit il est en mode compilation.</p>

<p>En mode EXECUTION :</p> <!-- Begin List -->
<ul>
<li>Si le mot lu est connu du
dictionnaire alors il est alors ex&eacute;cut&eacute;;</li>
<li>sinon l'analyseur (parser)
v&eacute;rifie que le mot lu n'est pas un nombre (dans la base actuelle) : si
c'est le cas alors un nombre est alors d&eacute;pos&eacute; dans la pile de
donn&eacute;es;</li>
<li>sinon le mot n'est pas connu et n'est pas un nombre : une
erreur pr&eacute;vient l'utilisateur et arr&ecirc;te le processus.</li>
</ul>
<!-- End list -->

<p>En mode COMPILATION les mots non-imm&eacute;diats qui sont lus, s'ils sont
connus du dictionnaire, leurs CFA sont ajout&eacute;s les uns &agrave; la suite des
autres au dans la d&eacute;finition courante du dictionnaire. Si un mot n'est
pas connu une erreur pr&eacute;vient l'utilisateur et arr&ecirc;te le
processus.</p>

<p>Du peu de mots Forth que l'on a vus, c'est le mot : qui force le
mode COMPILATION de l'interpr&eacute;teur alors que le mot ; le fait passer
en mode EXECUTION. On peut d&eacute;j&agrave; se poser la question comment l'inter
peut passer en mode ex&eacute;cution avec le mot ; s'il ne fait que compiler
tous les mots qu'il voit; logiquement, il ne devrait jamais s'arr&ecirc;ter
de compiler. La r&eacute;ponse vient du champ <strong>FLAGS</strong> o&ugrave; l'un des bits
permet de rendre un mot Forth imm&eacute;diat. Par imm&eacute;diat on sous-entend
que le mot sera imm&eacute;diatement ex&eacute;cut&eacute; m&ecirc;me si l'interpr&eacute;teur est en
mode compilation. Attention: un mot imm&eacute;diat ne commute pas le mode de
l'interpr&eacute;teur : il est simplement interpr&eacute;t&eacute; !</p>

<p>On raffine donc le d&eacute;finition et l'on profite pour ajouter un cas
particulier :</p>
<p>En mode COMPILATION :</p> <!-- Begin List -->
<ul>
<li>les mots non imm&eacute;diats lus, s'ils
sont connus du dictionnaire, sont ajout&eacute;s les uns &agrave; la suite des
autres au dictionnaire dans la d&eacute;finition courante;</li>
<li>Si le mot est
imm&eacute;diat et connu du dictionnaire il est alors interpr&eacute;t&eacute;;</li>
<li>si le mot
n'est pas connu il est test&eacute; pour savoir si c'est un nombre : si oui</li>
<li>il est ajout&eacute; &agrave; la d&eacute;finition mais on intercalera avant le mot
LITERAL pour ne pas l'interpr&eacute;ter comme un mot Forth; sinon le mot
n'est pas connu une erreur pr&eacute;vient l'utilisateur et arr&ecirc;te le
processus.</li>
</ul>
<!-- End list -->

<p>Si l'inter lit tous les mots les uns apr&egrave;s les autres, avec le code</p>
<div class="code"><pre><code><font color="green"><strong>: FOO</strong></font> * * <font color="ff9900"><strong>;</strong></font>
</code></pre></div>
<p>FOO n'&eacute;tant pas d&eacute;fini, l'interpr&eacute;teur devrait d&eacute;clencher une
erreur. En fait non, car comme on l'a dit l'interpr&eacute;teur sait lire le
mot suivant et le mot : quand il est ex&eacute;cut&eacute; va lire le mot suivant, &agrave;
savoir FOO afin de cr&eacute;er une nouvelle entr&eacute;e dans le dictionnaire. Par
cons&eacute;quent le mot suivant que l'interpr&eacute;teur va lire sera *.</p>

<p>L'interpr&eacute;teur Forth &agrave; deux modes (&eacute;tats) soit il est en mode
interpr&eacute;tation soit en mode compilation. Des mots comme : et ;
permettent respectivement de passer en mode compilation puis
interpr&eacute;tation.</p>

<!-- Begin List -->
<ul>
<li>En mode interpr&eacute;tation, la d&eacute;finition des mots lus sont
recherch&eacute;s dans le dictionnaire puis ex&eacute;cut&eacute;s.</li>
<li>En mode compilation,
une ent&ecirc;te dans le dictionnaire est cr&eacute;&eacute;e afin de permettre de
retrouver le nouveau mot, puis chaque mot lus, s'ils ne sont pas
consid&eacute;r&eacute;s comme imm&eacute;diats, sont recherch&eacute;s dans le dictionnaire et
leur r&eacute;f&eacute;rence stock&eacute;e dans la d&eacute;finition du mot en cours de
d&eacute;finition.</li>
</ul>
<!-- End list -->

<p>Le mot <font color="ff9900"><strong>IMMEDIAT</strong></font> rend imm&eacute;diat le dernier mot du
dictionnaire. Pour rappel un mot imm&eacute;diat n'est pas compilable mais
directement interpr&eacute;t&eacute; quand l'interpr&eacute;teur est en mode
compilation. Voici un exemple plus &eacute;volu&eacute; de mot imm&eacute;diat : on se
propose d'ajouter un syst&egrave;me de commentaires &agrave; Forth. Pour cela on
suppose que le mot TYPE existe d&eacute;j&agrave; (ce qui en g&eacute;n&eacute;ral le cas) ce mot
permet d'ignorer les caract&egrave;res du tampon d'entr&eacute;e jusqu'au caract&egrave;re
indiqu&eacute; comme param&egrave;re.</p> <div class="code"><pre><code><font color="green"><strong>: &#40;</strong></font> '&#41;' TYPE <font color="ff9900"><strong>;
IMMEDIATE</strong></font> </code></pre></div>

<p>D&eacute;s que le 'analyseur ex&eacute;cutera le mot ( il ignorera tous les mots
jusqu'&agrave; trouver le mot ) et comme il est imm&eacute;diat il va fonctionner
dans une d&eacute;finition (quand l'interpr&eacute;teur sera en mode
compilation). Notons qu'il existe un autre type de commentaire Forth
le mot \ ignore enti&egrave;rement la ligne courante.</p>

<p>Si l'on d&eacute;sire rendre imm&eacute;diat un certains nombre de mots de fa&ccedil;on
temporaire dans une d&eacute;finition il faut les d&eacute;limiter par les mots &#91;
et #&#93;. Ces mots modifient l'&eacute;tat de l'interpr&eacute;teur: interpr&eacute;tation
ou compilation mais ne changent pas le smudge bit des mots.</p>

<p>Si l'on d&eacute;sire compiler un mot imm&eacute;diat il faut placer avant le mot
&#91;COMPILE#&#93; (qui lui aussi est imm&eacute;diat). Le mot COMPILE joue
le m&ecirc;me r&ocirc;le que &#91;COMPILE#&#93; mais est non imm&eacute;diat. Il permet
de ... TODO A FINIR ... Notons que ces mots sont d&eacute;suets &agrave; cause du
risque de confusion pour les d&eacute;veloppeurs pour se souvenir de qui est
imm&eacute;diat, par cons&eacute;quent on utilisera plut&ocirc;t le mot POSTPONE qui
appelle l'un ou l'autre automatiquement selon le caract&egrave;re imm&eacute;diat du
mot qui lui succ&eacute;de.</p>

<p>On se propose de cr&eacute;er deux nouveaux Forth : DO et LOOP qui
permettent de faire une boucle. On supposera l'existence d'un mot
Forth (non officiel) 0BRANCH qui fait un saut relatif &agrave; la
condition que le sommet de la pile vaut 0.</p>
<div class="code"><pre><code><font color="green"><strong>: DO</strong></font>
  COMPILE SWAP
  COMPILE &#62;R
  COMPILE &#62;R
  HERE
<font color="ff9900"><strong>; IMMEDIATE</strong></font>

<font color="green"><strong>: LOOP</strong></font>
  COMPILE R&#62;
  COMPILE 1+
  COMPILE R&#62;
  COMPILE 2DUP
  COMPILE &#62;R
  COMPILE &#62;R
  COMPILE &#60;
  COMPILE 0=
  COMPILE 0BRANCH
  HERE - ,
  COMPILE R&#62;
  COMPILE R&#62;
  COMPILE 2DROP
<font color="ff9900"><strong>; IMMEDIATE</strong></font>
</code></pre></div>

<p>Voici un exemple typique de ces mots qui affiche ...</p>
<div class="code"><pre><code>: DECADE <font color="red"><strong>10 0</strong></font> DO  <font color="red"><strong>1</strong></font> . LOOP ;
</code></pre></div>

D&eacute;taillons le code Forth: DO: les 2 parametres : fin et d&eacute;but
d'it&eacute;ration. Sont commutes puis stock&eacute;s dans la pile de retour.

LOOP: les 2 param sont remis dans la pile de donn&eacute;es et litt&eacute;rateur
est incr&eacute;mente. Le 2DUP permet de remettre les param dans la pile de
retour et de les comparer entre eux. S'ils sont &eacute;gaux 0BRANCH laisse pas

Voici en m&eacute;moire comment est le mot
<font color="red"><strong>10 0</strong></font>
SWAP &#62;R &#62;R
<font color="red"><strong>1</strong></font> .
R&#62; 1+ R&#62; 2DUP &#62;R &#62;R &#60; 0= 0BRANCH <font color="red"><strong>0xe8</strong></font> R&#62; R&#62; 2DROP
EXIT
  Nous voyons les mots en provenance du mot DO:
  SWAP &#62;R &#62;R

  Nous voyons les mots en provenance du mot LOOP:
  R&#62; 1+ R&#62; 2DUP &#62;R &#62;R &#60; 0= 0BRANCH <font color="red"><strong>0xe8</strong></font> R&#62; R&#62; 2DROP
O&ugrave; 0xe8 et la diff&eacute;rence d'adresse entre le HERE du DO et le HERE du
    LOOP permettant d'it&eacute;rer le calcul.

    et 1 . le code du calcul.

<div class="right"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></div></div>
<!-- Subsection: Fonctionnement de interpr&eacute;teur interne -->
<a id="interpreteur" name="interpreteur"></a><h2><img class="icone20" src="icons/gear.png" alt=""/>Fonctionnement de interpr&eacute;teur interne</h2>
<div class="boite"> 

<img class="icone30" src="icons/construction.gif" alt="EN CONSTRUCTION"/>
                                    
                                    Expliquer le mot COMPILE

<div class="right"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></div></div>
<!-- Subsection: Variables et constante -->
<a id="var" name="var"></a><h2><img class="icone20" src="icons/gear.png" alt=""/>Variables et constante</h2>
<div class="boite"> 

<img class="icone30" src="icons/construction.gif" alt="EN CONSTRUCTION"/>

<p>Nous avons vu que Forth permet de stocker des mots Forth mais il
peut &eacute;galement servir &agrave; stocker de la m&eacute;moire. En effet on a dit dans
une section pr&eacute;c&eacute;dente que la variable DP permet de changer o&ugrave; HERE
indique le premier emplacement libre. Par cons&eacute;quent on peut se
r&eacute;server des emplacements m&eacute;moires et l'id&eacute;al est de donner un nom aux
emplacemets.</p>

<p>Le mot ALLOC permet de d&eacute;placer DP du nombre d'octet voulu (un
ALLOC pour 1 cellule est le mot ,)</p>

<div class="right"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></div></div>
<!-- Subsection: Un langage evolutif -->
<a id="evol" name="evol"></a><h2><img class="icone20" src="icons/gear.png" alt=""/>Un langage evolutif</h2>
<div class="boite"> 

<img class="icone30" src="icons/construction.gif" alt="EN CONSTRUCTION"/> BUILD DOES, OO

        </div>
    </td>
    <!-- END ARTICLE BODY -->

    <!-- BEGIN <div class="right"></div> BORDER -->
    <td id="right_border"> <!-- empty --> </td>
    <!-- END <div class="right"></div> BORDER -->
  </tr>

  <!-- DOCUMENT FOOTER -->
  <tr>
    <td colspan="3" id="footer">
          <!-- BEGIN USER FOOTER -->
          

          
<table width="90%" align="center">
    <tr>
        <td align="center"><h3>Article pr&eacute;c&eacute;dent:</h3></td>
        <td align="center"><h3>Page d'accueil</h3></td>
        <td align="center"><h3>Aller en haut</h3></td>
        <td align="center"><h3>Article suivant:</h3></td>
    </tr>
    <tr>
        <td align="center"><a href="dyna-fr.html"><img class="icone5" src="icons/2leftarrow.png" alt="ext Prev"/></a></td>
        <td align="center"><a href="index-fr.html"><img class="icone5" src="icons/home.png" alt="home"/></a></td>
        <td align="center"><a href="#top_page"><img class="icone5" src="icons/2uparrow.png" alt="up"/></a></td>
        <td align="center"><a href="maxplus-fr.html"><img class="icone5" src="icons/2rightarrow.png" alt="Next"/></a></td>
    </tr>
    <tr>
        <td align="center">Principe moindre action</td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center">Bo&icirc;te &agrave; outils Max+</td>
    </tr>
</table>
          <!-- END USER FOOTER -->
    </td>
  </tr>
</table>
<!-- HTML EOF -->
</body>
</html>

<!-- This page was generated by script Sun 29 Sep 19 -->
